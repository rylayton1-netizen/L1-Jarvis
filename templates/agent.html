<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>{{ company.name }} - AI Assistant</title>
<link href="https://cdn.jsdelivr.net/npm/tailwindcss@3.3.2/dist/tailwind.min.css" rel="stylesheet">
<style>
#chatbox { display:flex; flex-direction:column; height:100vh; padding:1rem; }
#messages { flex:1; overflow-y:auto; margin-bottom:1rem; }
.message { margin-bottom:0.75rem; }
.message.user { text-align:right; }
#thinking { display:none; animation: pulse 1s infinite; }
@keyframes pulse { 0%, 100% { opacity:1; } 50% { opacity:0.5; } }
</style>
</head>
<body class="bg-gray-100">
<div id="chatbox" class="container mx-auto max-w-3xl bg-white rounded shadow">
  <div id="messages"></div>
  <div class="flex items-center space-x-2">
    <input id="userInput" type="text" placeholder="Type message..." class="flex-1 p-2 border rounded">
    <button id="sendBtn" class="px-4 py-2 bg-blue-600 text-white rounded">Send</button>
    <div id="thinking" class="text-gray-500">AI is thinking...</div>
  </div>
</div>

<script>
const messagesDiv = document.getElementById("messages");
const input = document.getElementById("userInput");
const sendBtn = document.getElementById("sendBtn");
const thinking = document.getElementById("thinking");

function appendMessage(text, sender){
  const div = document.createElement("div");
  div.className = "message " + sender;
  div.innerHTML = text.replace(/\n/g,"<br>");
  messagesDiv.appendChild(div);
  messagesDiv.scrollTop = messagesDiv.scrollHeight;
}

async function sendMessage(){
  const msg = input.value.trim();
  if(!msg) return;
  appendMessage(msg,"user");
  input.value="";
  thinking.style.display="inline";
  try{
    const resp = await fetch("/chat/{{ company.id }}", {
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({message: msg})
    });
    const data = await resp.json();
    if(data.ok){
      appendMessage(data.text,"ai");
    }else{
      appendMessage("Error: "+data.error,"ai");
    }
  }catch(e){
    appendMessage("Error: "+e,"ai");
  }
  thinking.style.display="none";
}

sendBtn.addEventListener("click", sendMessage);
input.addEventListener("keypress", e => { if(e.key==="Enter") sendMessage(); });
</script>
</body>
</html>
