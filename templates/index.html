<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>{{ company_name }} Agent Assistant</title>
<style>
body, html { margin:0; padding:0; height:100%; font-family: Arial, sans-serif; background-color: #1a1a1a; color: #fff; }
#chat-container {
    display: flex;
    flex-direction: column;
    height: 100%;
    width: 100%;
}
#chat-output {
    flex: 1;
    padding: 20px;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
    gap: 12px;
}
.message {
    padding: 10px 14px;
    border-radius: 12px;
    max-width: 75%;
    word-wrap: break-word;
}
.user { background-color: #00aaff; color: #fff; align-self: flex-end; text-align: right; }
.bot { background-color: #3a3a3a; color: #fff; align-self: flex-start; text-align: left; }
#chat-input {
    display: flex;
    border-top: 1px solid #444;
}
#chat-input input {
    flex: 1;
    padding: 14px;
    border: none;
    background-color: #3a3a3a;
    color: #fff;
    font-size: 1em;
}
#chat-input button {
    padding: 0 20px;
    background-color: #00aaff;
    color: #fff;
    border: none;
    cursor: pointer;
}
#chat-input button:hover { background-color: #008ecc; }
</style>
</head>
<body>
<div id="chat-container">
    <div id="chat-output"></div>
    <div id="chat-input">
        <input type="text" id="user-input" placeholder="Ask a question..." />
        <button onclick="sendMessage()">Send</button>
    </div>
</div>

<script>
const input = document.getElementById('user-input');

input.addEventListener('keydown', function(e) {
    if (e.key === 'Enter') {
        e.preventDefault();
        sendMessage();
    }
});

async function sendMessage() {
    const message = input.value.trim();
    if (!message) return;
    addMessage(message, 'user');
    input.value = '';

    try {
        const res = await fetch(`/query/{{ company_name }}`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
            body: `query=${encodeURIComponent(message)}`
        });
        const data = await res.json();
        addMessage(data.answer, 'bot');
    } catch (err) {
        addMessage("Error: Unable to get response", 'bot');
    }
}

function addMessage(text, sender) {
    const output = document.getElementById('chat-output');
    const div = document.createElement('div');
    div.classList.add('message', sender);
    div.textContent = text;
    output.appendChild(div);
    output.scrollTop = output.scrollHeight;
}
</script>
</body>
</html>
